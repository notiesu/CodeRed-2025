<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathsVoice - Accessible STEM Learning</title>
    <!-- CSS from static folder -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta name="description" content="Making STEM education accessible through AI-powered voice narration">
    <meta name="keywords" content="accessibility, STEM, education, math, science, voice, narration, visual impairment">
    <meta name="author" content="MathsVoice Team">
</head>
<body>
    <div class="container">
        <nav class="navbar" style="display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px); border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
            <div class="navbar-brand" style="display: flex; align-items: center;">
                <a href="{{ url_for('home') }}" style="text-decoration: none; color: white; font-size: 2rem; font-weight: 700;">
                    <span style="font-weight: 700;">MathsVoice</span>
                </a>
            </div>
            <div class="navbar-links" style="display: flex; gap: 18px;">
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('index') }}" class="btn btn-primary" aria-current="page" style="min-width: 90px;">App</a>
                    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary" style="min-width: 110px;">Dashboard</a>
                    <form action="{{ url_for('logout') }}" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-outline" aria-label="Logout" style="min-width: 90px; background: white; color: #667eea; border: none;">Logout</button>
                    </form>
                {% else %}
                    <a href="{{ url_for('login') }}" class="btn btn-outline" style="min-width: 90px; background: white; color: #667eea; border: none;">Login</a>
                    <a href="{{ url_for('register') }}" class="btn btn-primary" style="min-width: 90px;">Register</a>
                {% endif %}
            </div>
        </nav>
        <header class="header">
            <h1 class="title">MathsVoice</h1>
            <p class="subtitle">Submit your file(s) below!</p>
        </header>

        <main class="main-content">
            <!-- Upload Section -->
            <div class="upload-section" aria-labelledby="uploadSectionHeading">
                <h2 id="uploadSectionHeading">Upload Your Document</h2>
                <div id="uploadContainer"></div>
            </div>

            <!-- Processing Section -->
            <div class="processing-section" id="processingSection" style="display: none;" aria-labelledby="processingSectionHeading">
                <h2 id="processingSectionHeading">Processing Your Document</h2>
                <div id="processingContainer"></div>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection" style="display: none;" aria-labelledby="resultsSectionHeading">
                <h2 id="resultsSectionHeading">Results</h2>
                <div id="audioControlsContainer"></div>
                
                <div class="content-display">
                    <h3>Processed Content</h3>
                    <div id="contentOutput" class="content-text" tabindex="0" aria-live="polite"></div>
                </div>

                <div class="actions">
                    <button id="newDocumentBtn" class="btn btn-outline" aria-label="Process a new document">Process New Document</button>
                    <button id="toggleVideoBtn" class="btn btn-primary" style="display:none; margin-left:12px;" aria-label="Toggle video window">Subway Surfers</button>
                    {% if current_user.is_authenticated %}
                    <a id="viewDashboardLink" class="btn btn-secondary" href="{{ url_for('dashboard') }}" style="display:none;" aria-label="View this in your dashboard">View in Dashboard</a>
                    {% endif %}
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>Built for accessibility in STEM education</p>
        </footer>
    </div>

    <!-- Load configuration and utilities -->
    <script src="{{ url_for('static', filename='config.js') }}"></script>
    <script src="{{ url_for('static', filename='utils/latex-parser.js') }}"></script>
    <script src="{{ url_for('static', filename='utils/file-handler.js') }}"></script>
    <script src="{{ url_for('static', filename='utils/audio-manager.js') }}"></script>
    
    <!-- Load API modules -->
    <script type="module" src="{{ url_for('static', filename='api/api.js') }}"></script>

    <!-- Load components -->
    <script type="module" src="{{ url_for('static', filename='components/upload-area.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='components/processing-indicator.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='components/audio-controls.js') }}"></script>

    <!-- Voice selector -->
    <div id="voiceSelectorContainer" style="margin: 0 0 0px 0; padding: 0px 5px 0px 5px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); max-width: 300px; height: 50px; display: flex; align-items: center; justify-content: center;">
        <select id="voiceSelect" style="padding: 10px 12px; background: rgba(255, 255, 255, 0.95); border: 2px solid rgba(102, 126, 234, 0.3); border-radius: 8px; font-size: 14px; font-family: 'Inter', sans-serif; color: #333; cursor: pointer; transition: all 0.3s ease; outline: none; min-width: 150px; max-width: 100%; display: block; margin: 0 auto;" onmouseover="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'" onmouseout="this.style.borderColor='rgba(102, 126, 234, 0.3)'; this.style.boxShadow='none'" onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'" onblur="this.style.borderColor='rgba(102, 126, 234, 0.3)'; this.style.boxShadow='none'">
            <option value="">Loading voices...</option>
        </select>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const uploadSection = document.querySelector('.upload-section');
        if (!uploadSection) return;
        const selector = document.querySelector('#voiceSelectorContainer');
        if (selector) uploadSection.insertBefore(selector, uploadSection.firstChild);
    });
    </script>

    <!-- Floating Video Window -->
    <div id="videoWindow" style="display:none; position:fixed; bottom:20px; right:20px; width:280px; background:#1a1a1a; border-radius:12px; padding:12px; box-shadow: 0 8px 32px rgba(0,0,0,0.6); z-index:1000; resize:both; overflow:auto; min-width:200px; max-width:90vw;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; cursor:move;" id="videoWindowHeader">
            <span style="color:#fff; font-weight:600; font-size:14px;">Video Player</span>
            <button id="closeVideoWindow" style="background:#fff; color:#333; border:none; border-radius:50%; width:28px; height:28px; font-size:20px; cursor:pointer; line-height:1; font-weight:bold;" aria-label="Close video">&times;</button>
        </div>
        <video id="videoPlayer" width="100%" height="500" style="border-radius:8px; display:block; background:#000;" controls autoplay loop muted>
            <source src="{{ url_for('static', filename='subway.mp4') }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <!-- Load main application -->
    <script type="module" src="{{ url_for('static', filename='script.js') }}"></script>
    
    <!-- Floating Video Window Logic -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggleBtn = document.getElementById('toggleVideoBtn');
        const videoWindow = document.getElementById('videoWindow');
        const closeBtn = document.getElementById('closeVideoWindow');
        const videoPlayer = document.getElementById('videoPlayer');
        const header = document.getElementById('videoWindowHeader');
        
        if (toggleBtn && videoWindow && closeBtn && videoPlayer) {
            // Toggle video window
            toggleBtn.addEventListener('click', () => {
                if (videoWindow.style.display === 'none' || videoWindow.style.display === '') {
                    videoWindow.style.display = 'block';
                    toggleBtn.textContent = 'Hide Video';
                } else {
                    videoWindow.style.display = 'none';
                    toggleBtn.textContent = 'Watch Video';
                }
            });
            
            // Close button
            closeBtn.addEventListener('click', () => {
                videoWindow.style.display = 'none';
                toggleBtn.textContent = 'Watch Video';
                // Pause video when closing
                videoPlayer.pause();
            });
            
            // Make video window draggable
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            
            header.addEventListener('mousedown', (e) => {
                isDragging = true;
                initialX = e.clientX - videoWindow.offsetLeft;
                initialY = e.clientY - videoWindow.offsetTop;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    
                    videoWindow.style.left = currentX + 'px';
                    videoWindow.style.top = currentY + 'px';
                    videoWindow.style.bottom = 'auto';
                    videoWindow.style.right = 'auto';
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }
    });
    </script>
</body>
</html>
